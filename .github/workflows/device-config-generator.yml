name: Device Configuration Generator

on:
  workflow_dispatch:
    inputs:
      device_name:
        description: 'Device Name (e.g., PIXEL9PRO)'
        required: true
        type: string
      vendor_prop_url:
        description: 'Vendor build.prop URL'
        required: true
        type: string
      auto_commit:
        description: 'Auto commit to repository'
        required: false
        type: boolean
        default: true

jobs:
  generate-single-config:
    runs-on: ubuntu-latest
    
    steps:
      - name: ðŸ“¥ Checkout repository
        uses: actions/checkout@v4  # *** UPDATED to v4 ***
        with:
          token: ${{ secrets.GITHUB_TOKEN }}
      
      - name: ðŸ Setup Python
        uses: actions/setup-python@v5  # *** UPDATED to v5 ***
        with:
          python-version: '3.11'
      
      - name: ðŸ“¦ Install dependencies
        run: |
          pip install requests pyyaml
      
      - name: ðŸ”§ Generate device configuration
        id: generate
        run: |
          # [Previous Python script remains the same]
          mkdir -p configs
          python generator.py "${{ inputs.device_name }}" "${{ inputs.vendor_prop_url }}"
      
      - name: ðŸ“Š Generate summary
        run: |
          echo "## ðŸ“± Device Configuration Generated" >> $GITHUB_STEP_SUMMARY
          echo "- **Device**: ${{ inputs.device_name }}" >> $GITHUB_STEP_SUMMARY
      
      # *** CRITICAL FIX: Updated to v4 ***
      - name: ðŸ’¾ Upload artifact
        uses: actions/upload-artifact@v4
        with:
          name: config-${{ inputs.device_name }}
          path: configs/${{ inputs.device_name }}.json
          retention-days: 90  # *** NEW: Added retention policy ***
      
      - name: ðŸ”„ Commit changes
        if: inputs.auto_commit
        run: |
          git config --local user.email "github-actions[bot]@users.noreply.github.com"
          git config --local user.name "github-actions[bot]"
          git add configs/
          git commit -m "âœ¨ Add device config: ${{ inputs.device_name }}" || exit 0
          git push